import{a as e,e as o,E as i}from"./index-DbWvsKsa.js";class n{static instance;renderer=null;session=null;isInitialized=!1;constructor(){console.log("ü•Ω XRManager initialized")}static getInstance(){return n.instance||(n.instance=new n),n.instance}initialize(r){this.renderer=r,this.isInitialized=!0,this.checkSupport(),console.log("‚úÖ XRManager initialized with renderer")}async checkSupport(){if(!("xr"in navigator)){console.warn("‚ö†Ô∏è WebXR not supported in this browser"),e.setXRSupported(!1),e.setXRError("WebXR not supported"),o.emit(i.XR_SUPPORT_CHECKED,{supported:!1});return}try{await navigator.xr?.isSessionSupported("immersive-vr")?(e.setXRSupported(!0),e.setXRError(null),console.log("‚úÖ WebXR VR supported"),o.emit(i.XR_SUPPORT_CHECKED,{supported:!0,mode:"vr"})):(e.setXRSupported(!1),e.setXRError("Immersive VR not supported"),console.warn("‚ö†Ô∏è Immersive VR not supported"),o.emit(i.XR_SUPPORT_CHECKED,{supported:!1}))}catch(r){console.error("‚ùå Error checking XR support:",r),e.setXRSupported(!1),e.setXRError("Error checking XR support"),o.emit(i.XR_SUPPORT_CHECKED,{supported:!1})}}async enterXR(r="vr"){if(!this.renderer||!this.isInitialized)throw new Error("XRManager not initialized");if(!e.xrState.supported)throw new Error("XR not supported");if(e.xrState.active){console.warn("‚ö†Ô∏è Already in XR session");return}try{console.log(`ü•Ω Entering XR mode: ${r}...`);const t=navigator.xr,s=r==="vr"?"immersive-vr":"immersive-ar";this.session=await t.requestSession(s,{requiredFeatures:["local-floor"],optionalFeatures:["bounded-floor","hand-tracking"]}),await this.renderer.xr.setSession(this.session),e.setXRActive(!0,r),e.setXRError(null),this.session&&this.session.addEventListener("end",()=>{this.onSessionEnd()}),console.log(`‚úÖ Entered XR mode: ${r}`),o.emit(i.XR_SESSION_STARTED,{mode:r})}catch(t){console.error("‚ùå Failed to enter XR:",t);let s="Unknown error";throw t.name==="SecurityError"?s="VR access denied or cancelled":t.name==="NotSupportedError"?s="VR configuration not supported":t.name==="NotAllowedError"?s="VR permission denied":s=t.message||"Failed to enter VR",e.setXRError(s),e.setXRActive(!1),o.emit(i.XR_SESSION_FAILED,{error:s}),new Error(s)}}async exitXR(){if(!this.session){console.warn("‚ö†Ô∏è No active XR session");return}try{console.log("ü•Ω Exiting XR..."),await this.session.end(),this.session=null,e.setXRActive(!1),console.log("‚úÖ Exited XR"),o.emit(i.XR_SESSION_ENDED,{})}catch(r){throw console.error("‚ùå Error exiting XR:",r),r}}onSessionEnd(){console.log("ü•Ω XR session ended"),this.session=null,e.setXRActive(!1),o.emit(i.XR_SESSION_ENDED,{})}get isActive(){return e.xrState.active}get isSupported(){return e.xrState.supported}getSession(){return this.session}dispose(){this.session&&(this.session.end().catch(console.error),this.session=null),this.renderer=null,this.isInitialized=!1,e.setXRActive(!1),console.log("ü•Ω XRManager disposed")}}const l=n.getInstance();export{n as XRManager,l as xrManager};
